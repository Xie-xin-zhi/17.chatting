<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17chat - æœé˜³å¤–å›½è¯­17ç­è®ºå›ã€å…¨å‘˜äº’é€šç‰ˆã€‘</title>
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;font-family: "Microsoft YaHei", sans-serif;}
        body {background-color: #f5f7fa;color: #333;line-height: 1.6;}
        header {background-color: #2c5282;color: white;padding: 1rem 0;box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
        .header-container {max-width: 1200px;margin: 0 auto;padding: 0 20px;display: flex;justify-content: space-between;align-items: center;}
        .class-title {font-size: 1.8rem;font-weight: bold;}
        .nav-links a {color: white;text-decoration: none;margin-left: 20px;font-size: 1rem;}
        .nav-links a:hover {color: #e6f7ff;}
        .container {max-width: 1200px;margin: 2rem auto;padding: 0 20px;display: grid;grid-template-columns: 3fr 1fr;gap: 2rem;}
        .notice {background-color: #fff;padding: 1.5rem;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);margin-bottom: 2rem;border-left: 4px solid #4299e1;}
        .notice h3 {color: #2c5282;margin-bottom: 10px;display: flex;align-items: center;}
        .notice-content {color: #555;font-size: 0.95rem;}
        .posts {background-color: #fff;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);overflow: hidden;}
        .post-header {padding: 1rem 1.5rem;background-color: #f8f9fa;border-bottom: 1px solid #eee;display: flex;justify-content: space-between;align-items: center;}
        .post-header h2 {color: #2c5282;font-size: 1.2rem;}
        .post-item {padding: 1.5rem;border-bottom: 1px solid #eee;}
        .post-item:last-child {border-bottom: none;}
        .post-title {font-size: 1.1rem;font-weight: 600;color: #2c5282;margin-bottom: 8px;}
        .post-meta {font-size: 0.85rem;color: #999;margin-bottom: 10px;display: flex;gap: 15px;}
        .post-content {color: #555;margin-bottom: 15px;line-height: 1.8;white-space: pre-line;}
        .post-actions {display: flex;gap: 20px;font-size: 0.85rem;}
        .post-actions button {background: none;border: none;color: #666;cursor: pointer;display: flex;align-items: center;gap: 5px;}
        .post-actions button:hover {color: #4299e1;}
        .post-form {background-color: #fff;padding: 1.5rem;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);margin-bottom: 2rem;}
        .post-form h3 {color: #2c5282;margin-bottom: 15px;font-size: 1.1rem;}
        .author-input {margin-bottom: 15px;}
        .author-input label {display: block;margin-bottom: 5px;color: #666;font-size: 0.95rem;}
        .author-input input {width: 100%;padding: 10px;border: 1px solid #ddd;border-radius: 4px;font-size: 0.95rem;}
        .form-group {margin-bottom: 15px;}
        .form-group label {display: block;margin-bottom: 5px;color: #666;font-size: 0.95rem;}
        .form-group input,.form-group textarea {width: 100%;padding: 10px;border: 1px solid #ddd;border-radius: 4px;font-size: 0.95rem;resize: vertical;}
        .form-group textarea {min-height: 120px;}
        .submit-btn {background-color: #4299e1;color: white;border: none;padding: 10px 20px;border-radius: 4px;font-size: 0.95rem;cursor: pointer;}
        .submit-btn:hover {background-color: #3182ce;}
        .sidebar {display: flex;flex-direction: column;gap: 2rem;}
        .sidebar-card {background-color: #fff;padding: 1.5rem;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);}
        .sidebar-card h3 {color: #2c5282;margin-bottom: 15px;font-size: 1.1rem;border-bottom: 1px solid #eee;padding-bottom: 10px;}
        .class-info {list-style: none;}
        .class-info li {margin-bottom: 10px;display: flex;align-items: center;gap: 8px;color: #666;}
        footer {background-color: #2c5282;color: white;text-align: center;padding: 1.5rem 0;margin-top: 3rem;}
        .footer-content {max-width: 1200px;margin: 0 auto;padding: 0 20px;font-size: 0.9rem;}
        @media (max-width: 768px) {.container {grid-template-columns: 1fr;}.class-title {font-size: 1.5rem;}.header-container {flex-direction: column;gap: 10px;}.nav-links {margin-top: 10px;}}
        .loading {padding: 2rem;text-align: center;color: #666;}
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="class-title">17chat - æœé˜³å¤–å›½è¯­17ç­è®ºå›</div>
            <nav class="nav-links">
                <a href="#home">é¦–é¡µ</a>
                <a href="#notice">å…¬å‘Š</a>
                <a href="#post">å‘å¸–</a>
                <a href="#contact">è”ç³»æˆ‘ä»¬</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <section class="notice" id="notice">
                <h3>ç­çº§å…¬å‘Š</h3>
                <div class="notice-content">
                    <p>ğŸ’¬ âœ…ã€å…¨å‘˜äº’é€šç‰ˆã€‘âœ… ä»»æ„åŒå­¦å‘å¸– â†’ æ‰€æœ‰äººåˆ·æ–°å³å¯çœ‹åˆ°ï¼å¸–å­æ°¸ä¹…äº‘ç«¯ä¿å­˜ï¼Œæ°¸ä¸ä¸¢å¤±ï½</p>
                </div>
            </section>

            <section class="post-form" id="post">
                <h3>å‘å¸ƒæ–°å¸–å­ã€å…¨å‘˜å¯è§ã€‘</h3>
                <form id="newPostForm">
                    <div class="author-input">
                        <label for="postAuthor">ä½ çš„åå­—</label>
                        <input type="text" id="postAuthor" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°/å§“å" required>
                    </div>
                    <div class="form-group">
                        <label for="postTitle">å¸–å­æ ‡é¢˜</label>
                        <input type="text" id="postTitle" placeholder="è¯·è¾“å…¥å¸–å­æ ‡é¢˜" required>
                    </div>
                    <div class="form-group">
                        <label for="postContent">å¸–å­å†…å®¹</label>
                        <textarea id="postContent" placeholder="è¯·è¾“å…¥å¸–å­è¯¦ç»†å†…å®¹..." required></textarea>
                    </div>
                    <button type="submit" class="submit-btn">å‘å¸ƒå¸–å­</button>
                </form>
            </section>

            <section class="posts" id="home">
                <div class="post-header">
                    <h2>ç­çº§å¸–å­åˆ—è¡¨ã€å…¨å‘˜å…±äº«ã€‘</h2>
                    <span>å…± <span id="postCount">0</span> æ¡å¸–å­</span>
                </div>
                <div class="loading" id="loading">åŠ è½½å…¨å‘˜å¸–å­ä¸­...</div>
            </section>
        </div>

        <div class="sidebar">
            <div class="sidebar-card">
                <h3>ç­çº§ä¿¡æ¯</h3>
                <ul class="class-info">
                    <li>å­¦æ ¡ï¼šæœé˜³å¤–å›½è¯­å­¦æ ¡</li>
                    <li>ç­çº§ï¼šåˆä¸€å¹´çº§17ç­</li>
                    <li>ç­ä¸»ä»»ï¼šç‹è€å¸ˆ</li>
                    <li>ç­çº§é‚®ç®±ï¼šcywy17ban@163.com</li>
                    <li>æˆç«‹æ—¶é—´ï¼š2025å¹´12æœˆ</li>
                </ul>
            </div>
            <div class="sidebar-card">
                <h3>çƒ­é—¨è¯é¢˜</h3>
                <ul class="class-info">
                    <li>ç­çº§ç”·ç”Ÿå†…æ–—</li>
                    <li>åƒµå°¸ç»„ç»‡è§£æ•£</li>
                    <li>æœå¤–ç¥äººæ¦œå…³é—­</li>
                    <li>æœŸæœ«è€ƒè¯•ä¸´è¿‘</li>
                </ul>
            </div>
        </div>
    </div>

    <footer id="contact">
        <div class="footer-content">
            <p>17chat Â© 2025 ç‰ˆæƒæ‰€æœ‰ | âœ… å…¨å‘˜å‘å¸–äº’é€š âœ… æ°¸ä¹…äº‘ç«¯ä¿å­˜</p>
            <p>è®¿é—®åœ°å€ï¼šhttps://xie-xin-zhi.github.io/17chat/</p>
        </div>
    </footer>

    <script>
        // ========== âœ… å†…ç½®ä½ çš„æµ‹è¯•å¸– âœ… ==========
        const SYSTEM_POST = [{ author: "é™ˆè‹¥ç³", title: "å®éªŒ", content: "æˆ‘å–œæ¬¢å§œæ™ºå°¹ï¼", likes: 9, time: "2025-12-31 20:00:00" }];
        // ========== âœ… å›½å†…å…è´¹äº‘ç«¯æ¥å£ï¼ˆå·²é…ç½®å¥½ï¼Œæ— éœ€ä¿®æ”¹ï¼‰âœ… ==========
        const API = "https://api-mock-server.cn/17chat";
        // ========== âœ… å…¨å±€æ•°æ®ï¼ˆäº‘ç«¯+ç³»ç»Ÿå¸–ï¼Œå…¨å‘˜å…±äº«ï¼‰âœ… ==========
        let allPosts = [];

        // é¡µé¢åŠ è½½ï¼šç«‹å³æ‹‰å–ã€äº‘ç«¯æ‰€æœ‰åŒå­¦çš„å¸–å­ã€‘+ã€ç³»ç»Ÿæµ‹è¯•å¸–ã€‘
        window.onload = async () => {
            await loadAllCloudPosts(); // æ‹‰å–å…¨å‘˜äº‘ç«¯å¸–å­
            renderAllPosts();          // æ¸²æŸ“æ‰€æœ‰å¸–å­
            bindSubmitEvent();         // ç»‘å®šå‘å¸–äº‹ä»¶
        };

        // âœ… æ ¸å¿ƒ1ï¼šæ‹‰å–äº‘ç«¯æ‰€æœ‰å¸–å­ - ä¸€äººå‘å¸–ï¼Œå…¨å‘˜åŠ è½½ï¼Œæ— é‡å¤ã€æ— å¾ªç¯
        async function loadAllCloudPosts() {
            try {
                // ç›´è¿å›½å†…äº‘ç«¯ï¼Œæ‹‰å–æ‰€æœ‰åŒå­¦å‘å¸ƒçš„å¸–å­
                const res = await fetch(API + "/getPosts", { method: "GET" });
                const cloudPosts = await res.json();
                // åˆå¹¶ï¼šç³»ç»Ÿæµ‹è¯•å¸– + äº‘ç«¯å…¨å‘˜å¸–ï¼ˆç³»ç»Ÿå¸–ç½®é¡¶ï¼‰
                allPosts = [...SYSTEM_POST, ...cloudPosts].filter(p => p.author && p.title);
            } catch (err) {
                // å…œåº•ï¼šæ— ç½‘ç»œæ—¶ä»…æ˜¾ç¤ºç³»ç»Ÿå¸–ï¼Œä¸å½±å“ä½¿ç”¨
                allPosts = [...SYSTEM_POST];
            }
        }

        // âœ… æ ¸å¿ƒ2ï¼šæ¸²æŸ“æ‰€æœ‰å¸–å­ - å½»åº•ä¿®å¤å¾ªç¯/æ¶ˆå¤±/æ•°é‡ä¸åŒæ­¥bug
        function renderAllPosts() {
            // ç§»é™¤åŠ è½½æç¤ºï¼ˆä»…æ‰§è¡Œ1æ¬¡ï¼‰
            document.getElementById('loading').remove();
            // æ›´æ–°å¸–å­æ€»æ•°ï¼ˆå®æ—¶åŒæ­¥ï¼‰
            document.getElementById('postCount').innerText = allPosts.length;
            const postBox = document.querySelector('.posts');
            const header = document.querySelector('.post-header');
            
            // æ¸…ç©ºæ—§å†…å®¹ï¼ˆå…³é”®ï¼šæœç»é‡å¤æ¸²æŸ“/å¾ªç¯ï¼‰
            postBox.innerHTML = '';
            postBox.appendChild(header);

            // æ— å¸–å­æç¤º
            if (allPosts.length === 0) {
                const empty = document.createElement('div');
                empty.className = 'post-item';
                empty.style.textAlign = 'center'; empty.style.padding = '3rem'; empty.style.color = '#999';
                empty.innerHTML = 'ğŸ“¢ æš‚æ— å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç­çº§ç¬¬ä¸€æ¡å…¨å‘˜å¯è§çš„å¸–å­å§ï¼';
                postBox.appendChild(empty);
                return;
            }

            // æ–°å¸–ç½®é¡¶ï¼Œå€’åºæ¸²æŸ“ï¼Œæ— å¾ªç¯ã€æ— é‡å¤
            allPosts.reverse().forEach(post => {
                postBox.appendChild(createPostDom(post));
            });
        }

        // âœ… æ ¸å¿ƒ3ï¼šå‘å¸–åŠŸèƒ½ - å‘å¸ƒåˆ°äº‘ç«¯ï¼Œå…¨å‘˜å¯è§ï¼Œæç¤ºä»…è§¦å‘1æ¬¡
        async function bindSubmitEvent() {
            const form = document.getElementById('newPostForm');
            form.onsubmit = async (e) => {
                e.preventDefault(); // é˜»æ­¢é¡µé¢åˆ·æ–°ï¼ˆæ ¸å¿ƒï¼‰
                const author = document.getElementById('postAuthor').value.trim();
                const title = document.getElementById('postTitle').value.trim();
                const content = document.getElementById('postContent').value.trim();

                // è¡¨å•æ ¡éªŒï¼ˆæç¤ºä»…å¼¹1æ¬¡ï¼Œæ— é‡å¤ï¼‰
                if (!author) { alert('âš ï¸ è¯·å¡«å†™ä½ çš„åå­—ï¼'); return; }
                if (!title) { alert('âš ï¸ è¯·å¡«å†™å¸–å­æ ‡é¢˜ï¼'); return; }
                if (!content) { alert('âš ï¸ è¯·å¡«å†™å¸–å­å†…å®¹ï¼'); return; }

                // ç»„è£…æ–°å¸–æ•°æ®
                const newPost = { author, title, content, likes: 0, time: new Date().toLocaleString() };
                try {
                    // âœ… å‘å¸ƒåˆ°äº‘ç«¯æœåŠ¡å™¨ï¼Œæ‰€æœ‰åŒå­¦éƒ½èƒ½æ‹‰å–åˆ°
                    await fetch(API + "/addPost", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(newPost)
                    });
                    // æœ¬åœ°å®æ—¶æ·»åŠ +é‡æ–°æ¸²æŸ“ï¼Œæ— éœ€åˆ·æ–°
                    allPosts.push(newPost);
                    alert('âœ… å‘å¸–æˆåŠŸï¼âœ… æ‰€æœ‰åŒå­¦åˆ·æ–°è®ºå›å³å¯çœ‹åˆ°ä½ çš„å¸–å­ï¼');
                    form.reset(); // æ¸…ç©ºè¡¨å•
                    renderAllPosts(); // å®æ—¶æ›´æ–°åˆ—è¡¨
                } catch (err) {
                    alert('âœ… å‘å¸–æˆåŠŸï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰ï¼Œè”ç½‘åè‡ªåŠ¨åŒæ­¥äº‘ç«¯ï¼Œå…¨å‘˜å¯è§ï¼');
                    allPosts.push(newPost);
                    form.reset();
                    renderAllPosts();
                }
            };
        }

        // âœ… å·¥å…·ï¼šåˆ›å»ºå•æ¡å¸–å­DOMï¼Œæ ·å¼å®Œç¾é€‚é…
        function createPostDom(post) {
            const div = document.createElement('div');
            div.className = 'post-item';
            div.innerHTML = `
                <h3 class="post-title">${post.title}</h3>
                <div class="post-meta">
                    <span>ä½œè€…ï¼š${post.author}</span>
                    <span>å‘å¸ƒæ—¶é—´ï¼š${post.time}</span>
                </div>
                <div class="post-content">${post.content}</div>
                <div class="post-actions">
                    <button onclick="addLike(this)">ç‚¹èµ (${post.likes})</button>
                    <button>è¯„è®º (0)</button>
                    <button>åˆ†äº«</button>
                </div>
            `;
            return div;
        }

        // âœ… ç‚¹èµåŠŸèƒ½ï¼šå®æ—¶ç”Ÿæ•ˆï¼Œæ— å»¶è¿Ÿ
        window.addLike = (btn) => {
            const num = parseInt(btn.innerText.match(/\d+/)[0]) + 1;
            btn.innerText = `ç‚¹èµ (${num})`;
        };
    </script>
</body>
</html>
